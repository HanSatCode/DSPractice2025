#include <stdio.h>
#include <stdlib.h>
#define MAX(x, y) (((x) > (y)) ? (x) : (y))
#define COMPARE(x, y) (((x) < (y)) ? -1 : ((x) == (y)) ? 0 : 1)

int tempCoef, tempExpon; int sizeA = 0; int sizeB = 0; // 전역 변수
int avail = 0;

typedef struct {
	float coef; // 계수 (실수)
	int expon; // 차수 (양의 정수)
} polynomial;
polynomial* temp; // 전역 변수로 선언

void attach(float confficient, int exponent) { /* 새로운 항을 다항식에 추가한다. */
	temp[avail].coef = confficient;
	temp[avail++].expon = exponent;
}

polynomial* padd(polynomial* A, polynomial* B) { /* A(x)와 B(x)를 더하여 새 D(x)를 생성 */
	float coefficient;
	int startA = 0, startB = 0; int finishA = sizeA - 1, finishB = sizeB - 1;

	avail = 0; // 누적 인덱스 초기화
	temp = (polynomial*)malloc((sizeA + sizeB) * sizeof(polynomial)); // 항의 갯수는 많아봤자 A + B

	while (startA <= finishA && startB <= finishB) {
		switch (COMPARE(A[startA].expon, B[startB].expon)) {
		case -1: /* a의 차수가 b의 차수보다 작은 경우*/
			attach(B[startB].coef, B[startB].expon);
			startB++;
			break;
		case 0: /* 차수가 같은 경우 */
			coefficient = A[startA].coef + B[startB].coef;
			if (coefficient) attach(coefficient, A[startA].expon); // 계수가 0이 아니면
			startA++;
			startB++;
			break;
		case 1:  /* a의 차수가 b의 차수보다 큰 경우*/
			attach(A[startA].coef, A[startA].expon);
			startA++;
		}
	}
	for (; startA <= finishA; startA++) // A(x)의 남은 항들을 D(x)에 첨가
		attach(A[startA].coef, A[startA].expon);
	for (; startB <= finishB; startB++) // B(x)의 남은 항들을 D(x)에 첨가
		attach(B[startB].coef, B[startB].expon);
	return temp;
}

int main(void) {
	// 정렬 자체는 지수를 내림차순으로 넣으면 됨 (내림차순 정렬 구현 안해도됨)
	int capA = 10, capB = 10;
	polynomial* A = (polynomial*)malloc(capA * sizeof(polynomial));
	polynomial* B = (polynomial*)malloc(capB * sizeof(polynomial));

	while (1) {
		printf("[%d번째] A(x)의 계수와 차수를 순서대로 입력하세요. (종료는 -1 -1) : ", sizeA + 1);
		scanf("%d %d", &tempCoef, &tempExpon);
		if (tempCoef == -1 && tempExpon == -1) break; // 종료는 먼저 판단
		if (sizeA >= capA) {
			capA *= 2;
			A = (polynomial*)realloc(A, capA * sizeof(polynomial));
		}
		A[sizeA].coef = (float)tempCoef;
		A[sizeA].expon = tempExpon;
		sizeA++;
	}

	while (1) {
		printf("[%d번째] B(x)의 계수와 차수를 순서대로 입력하세요. (종료는 -1 -1) : ", sizeB + 1);
		scanf("%d %d", &tempCoef, &tempExpon);
		if (tempCoef == -1 && tempExpon == -1) break; // 종료는 먼저 판단
		if (sizeB >= capB) {
			capB *= 2;
			B = (polynomial*)realloc(B, capB * sizeof(polynomial));
		}
		B[sizeB].coef = (float)tempCoef;
		B[sizeB].expon = tempExpon;
		sizeB++;
	}

	polynomial* D = padd(A, B);

	printf("[D(x)]\tcoef\texpon\n");
	for (int i = 0; i < avail; i++) {
		printf("\t%.2f\t%d\n", D[i].coef, D[i].expon);
	}
}